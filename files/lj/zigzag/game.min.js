(function(){I.AdminTagEditor=function(){function AdminTagEditor(el,opts){var slug_input;this.opts=opts;this.el=$(el);slug_input=this.el.find(".slug_input");slug_input.textext({plugins:"autocomplete suggestions",suggestions:this.opts.slugs||[],ext:{core:{serializeData:function(_this){return function(data){return data}}(this)}}});this.el.dispatch("click",{feature_tag_btn:function(_this){return function(btn){var slug;slug=btn.closest("[data-slug]").data("slug");return slug_input.val(slug).trigger("keyup").focus()}}(this),close_btn:function(_this){return function(){return _this.el.remove()}}(this)})}return AdminTagEditor}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.setup_layout=function(){$("#inner_column").max_height($("#admin_panel").outerHeight(true)||0);$(window).on("message",function(_this){return function(e){var message,origin;origin=new RegExp("\\/\\/"+$(document.body).data("host")+"\\/");if(!e.originalEvent.origin.match){return}message=e.originalEvent.data;switch(message.name){case"dimensions":return parent.postMessage({width:$(document).width(),height:$(document).height()},"*")}}}(this));return new I.ViewGameFooter("#view_game_footer")};I.AfterDownloadLightbox=function(superClass){extend(AfterDownloadLightbox,superClass);function AfterDownloadLightbox(){return AfterDownloadLightbox.__super__.constructor.apply(this,arguments)}AfterDownloadLightbox.prototype.init=function(game1){var grid;this.game=game1;I.event("view_game","after_download_lb",""+this.game.id);grid=this.el.find(".game_grid_widget");new I.GameGrid(grid,{expected_size:240,selector:".after_download_lightbox_widget .game_cell .game_thumb",width_selector:".after_download_lightbox_widget .game_cell"});I.setup_grid_referrers(this.el,function(_this){return function(){return"after_download:"+_this.game.id}}(this));return I.tracked_links(this.el,"after_download_lb")};return AfterDownloadLightbox}(I.Lightbox);I.AdminPanel=function(){AdminPanel.prototype.toggle_editor=function(){this.theme_editor||(this.theme_editor=new I.ThemeEditor($("#theme_editor"),this.view_game.game,this.view_game));return this.theme_editor.el.toggleClass("visible")};function AdminPanel(el,view_game){var game;this.view_game=view_game;this.el=$(el);game=this.view_game.game;this.el.dispatch("click",{edit_theme_btn:function(_this){return function(){return _this.toggle_editor()}}(this)});if(window.location.hash.match(/\bedit_theme\b/)){this.toggle_editor()}}return AdminPanel}();I.EmbedGameLightbox=function(superClass){extend(EmbedGameLightbox,superClass);function EmbedGameLightbox(){return EmbedGameLightbox.__super__.constructor.apply(this,arguments)}return EmbedGameLightbox}(I.Lightbox);I.ReportGameLightbox=function(superClass){extend(ReportGameLightbox,superClass);function ReportGameLightbox(){return ReportGameLightbox.__super__.constructor.apply(this,arguments)}ReportGameLightbox.prototype.init=function(){var form,update_state;I.event2("view report game lightbox");form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "));return}return _this.el.addClass("submitted")}}(this),function(_this){return function(form){form.removeClass("has_error");if(!form.find("input[name='report[reason]']:checked").length){form.addClass("has_error");return false}return true}}(this));update_state=function(_this){return function(){var selected;selected=form.find("input[name='report[reason]']:checked").val();return _this.el.toggleClass("show_classifications",selected==="miscategorized")}}(this);return form.on("change",update_state)};return ReportGameLightbox}(I.Lightbox);I.ViewGameFooter=function(){function ViewGameFooter(el){this.el=$(el);this.el.dispatch("click",{embed_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.EmbedGameLightbox)}}(this),report_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.ReportGameLightbox)}}(this)})}return ViewGameFooter}();I.GameUserTools=function(){function GameUserTools(el){this.el=$(el);$(document.body).on("i:rating_updated",function(_this){return function(e,res){if(res.created){_this.el.find(".rate_game_btn").addClass("has_rating")}if(res.removed){return _this.el.find(".rate_game_btn").removeClass("has_rating")}}}(this));I.tracked_links(this.el,"view_game","user_tools");I.has_follow_button(this.el);this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this),rate_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.RateGameLightbox)}}(this)});setTimeout(function(_this){return function(){return _this.el.removeClass("hidden")}}(this),200)}return GameUserTools}();I.FirstGameLightbox=function(superClass){extend(FirstGameLightbox,superClass);function FirstGameLightbox(){this.first_show=bind(this.first_show,this);return FirstGameLightbox.__super__.constructor.apply(this,arguments)}FirstGameLightbox.prototype.first_show=function(){I.event("view_game","first_game_lb","show");I.add_facebook(function(_this){return function(){var cat;cat="view_game";FB.Event.subscribe("edge.create",function(url){return I.event(cat,"fb","like")});FB.Event.subscribe("edge.remove",function(url){return I.event(cat,"fb","unlike")});return FB.Event.subscribe("message.send",function(url){return I.event(cat,"fb","share")})}}(this));return I.add_twitter()};return FirstGameLightbox}(I.Lightbox);I.GameGoalBanner=function(){function GameGoalBanner(el){this.el=$(el);this.el.dispatch("click",{buy_btn:function(_this){return function(btn){I.event("view_game","goal_banner","contribute_btn");if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return $(".buy_row a.buy_btn").click()}}(this)})}return GameGoalBanner}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ImageViewer=function(){ImageViewer.prototype.margin=40;ImageViewer.prototype._template=function(){return'<div class="screenshot_lightbox lightbox loading">\n  <div class="screenshot_container">\n    <div class="loader"></div>\n\n    <div class="prev_image_btn">\n      <span class="icon-arrow-left"></span>\n    </div>\n\n    <img class="lb_screenshot hidden" width="400" height="315">\n\n    <div class="next_image_btn">\n      <span class="icon-arrow-right"></span>\n    </div>\n  </div>\n</div>'};ImageViewer.prototype.size_image=function(){};function ImageViewer(el){this.size_image=bind(this.size_image,this);this.el=$(el);this.el.on("click","[data-image_lightbox]",function(_this){return function(e){var all_links,current_image,goto_image,goto_next_image,goto_prev_image,lb,on_image_load,source_link;if(I.is_mobile()){return}if(!Image){return}source_link=$(e.currentTarget);all_links=source_link.closest(".screenshot_list").find("[data-image_lightbox]");I.event("view_game","screenshots","show");lb=I.Lightbox.open(_this._template(),I.CenterLighbox);lb.el.toggleClass("no_tools",all_links.length<2);current_image=null;on_image_load=function(image){var $window,ar,h,screenshot,w,window_height,window_width;current_image=image;$window=$(window);window_width=$window.width()-(_this.margin+20)*2;window_height=$window.height()-_this.margin*2;w=image.naturalWidth;h=image.naturalHeight;ar=w/h;if(w>window_width){w=window_width;h=window_width/ar}if(h>window_height){w=window_height*ar;h=window_height}screenshot=lb.el.find(".lb_screenshot");screenshot.attr("src",image.src);if(w!==image.naturalWidth||h!==image.naturalHeight){screenshot.attr("width",Math.floor(w)).attr("height",Math.floor(h))}else{screenshot.attr("width",image.naturalWidth).attr("height",image.naturalHeight)}lb.position();screenshot.removeClass("hidden");return lb.el.removeClass("loading")};goto_image=function(elem){var image;lb.el.addClass("loading");source_link=elem;image=new Image;image.onload=function(_this){return function(){return on_image_load(image)}}(this);return image.src=$(elem).attr("href")};goto_prev_image=function(){var prev;prev=source_link.prev("[data-image_lightbox]");if(!prev.length){prev=$(all_links[all_links.length-1])}return goto_image(prev)};goto_next_image=function(){var next;next=source_link.next("[data-image_lightbox]");if(!next.length){next=$(all_links[0])}return goto_image(next)};lb.el.dispatch("click",{lb_screenshot:function(btn){if(all_links.length<2){return I.Lightbox.close()}else{I.event("view_game","screenshots","click_screenshot");return goto_next_image()}},prev_image_btn:function(btn){I.event("view_game","screenshots","prev_image_btn");return goto_prev_image()},next_image_btn:function(btn){I.event("view_game","screenshots","next_image_btn");return goto_next_image()}});lb.el.on("i:lightbox_keydown",function(e,ke){switch(ke.keyCode){case 37:I.event("view_game","screenshots","keyboard_left");return goto_prev_image();case 39:I.event("view_game","screenshots","keyboard_right");return goto_next_image();case 32:I.event("view_game","screenshots","Keyboard_space");return goto_next_image()}});lb.el.on("i:lightbox_resize",function(){if(current_image){return on_image_load(current_image)}});goto_image(source_link);return false}}(this))}return ImageViewer}()}).call(this);(function(){var ImagePicker,ImageUpload,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.ThemeEditor=function(){function ThemeEditor(el,game,view){this.game=game;this.view=view;this.update_video=bind(this.update_video,this);this.el=$(el);this._column=$("#inner_column");this.setup_color_picker();this.setup_font_picker();this.setup_image_picker();this.setup_video_picker();this.setup_css_editor();this.el.find("form").remote_submit(function(_this){return function(res){if(res.success){return I.flash("Appearance updated")}}}(this));this.el.dispatch("click",{toggle_css_btn:function(_this){return function(){return _this.el.toggleClass("show_css")}}(this),cancel:function(_this){return function(){return _this.el.toggleClass("visible")}}(this)})}ThemeEditor.prototype.upload_prefix=function(){return this.el.data("upload_prefix")};ThemeEditor.prototype.setup_css_editor=function(){var debounced,update;this._style=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head"));update=function(_this){return function(){return _this._style.html(I.strip_css(_this.css_input.val()||""))}}(this);debounced=_.debounce(update,300);return this.css_input=this.el.find(".css_input").on("change",update).on("keyup",debounced)};ThemeEditor.prototype.update_video=function(url){var embed_url,frame,video_h,video_w,vimeo,youtube;video_w="347";video_h="280";(this._video_inputs||(this._video_inputs=this.el.find(".video_inputs"))).removeClass("has_error");(this._video_embed||(this._video_embed=this.view.el.find(".video_embed"))).empty();embed_url=(youtube=url.match(/youtube\.com.*v=(.*)\b/))?"//www.youtube.com/embed/"+youtube[1]:(vimeo=url.match(/vimeo.com\/\b(.*)\b/))?"//player.vimeo.com/video/"+vimeo[1]:void 0;if(embed_url){frame=$("<iframe width='"+video_w+"' height='"+video_h+"' frameborder='0' allowfullscreen></iframe>").attr("src",embed_url);return this._video_embed.append(frame)}else{if(!url.match(/^\s*$/)){return this._video_inputs.addClass("has_error")}}};ThemeEditor.prototype.update_background=function(image_picker){return(this._wrapper||(this._wrapper=$("#wrapper"))).css(image_picker.to_css())};ThemeEditor.prototype.update_banner=function(image_picker){var img,url;this._header||(this._header=$("#header"));this._header.removeClass().addClass("header");url=image_picker.el.data("image_url");if(url){img=this._header.find("img");this._header.addClass("has_image").addClass(image_picker.get_position());if(img.exists()){return img.attr("src",url)}else{return $("<img src='"+url+"'/>").appendTo(this._header)}}};ThemeEditor.prototype.setup_image_picker=function(){var uploaders;uploaders=this.el.find(".image_uploader");new ImagePicker(uploaders.filter(".background_uploader"),this,function(_this){return function(picker){return _this.update_background(picker)}}(this));return new ImagePicker(uploaders.filter(".banner_uploader"),this,function(_this){return function(picker){return _this.update_banner(picker)}}(this))};ThemeEditor.prototype.update_classes=function(){this._column.removeClass().addClass("inner_column");if(this.current_font_family){this._column.addClass("family_"+this.current_font_family)}if(this.current_font_size){return this._column.addClass("size_"+this.current_font_size)}};ThemeEditor.prototype.set_font_family=function(name){var font,style;this.fonts||(this.fonts=$(".font_family_picker").data("fonts"));if(font=this.fonts[name]){if(font.href&&!$("link[data-font='"+name+"']").exists()){$("<link rel='stylesheet' href='"+font.href+"' data-font='"+name+"'></link>").appendTo("head")}style=$("#font_family_style").exists()||$("<style id='font_family_style' type='text/css'>").appendTo("head");style.text(".inner_column{font-family: "+font.family+";}")}this.current_font_family=name;return this.update_classes()};ThemeEditor.prototype.set_font_size=function(name){this.current_font_size=name;return this.update_classes()};ThemeEditor.prototype.setup_font_picker=function(){var match,p;p=this.el.find(".font_inputs");this.font_family_picker=p.find(".font_family_picker").on("change",function(_this){return function(e){return _this.set_font_family(e.target.value)}}(this));this.font_size_picker=p.find(".font_size_picker").on("change",function(_this){return function(e){return _this.set_font_size(e.target.value)}}(this));if(match=this._column[0].className.match(/family_([^\s]+)/)){this.current_font_family=match[1]}if(match=this._column[0].className.match(/size_([^\s]+)/)){return this.current_font_size=match[1]}};ThemeEditor.prototype.setup_video_picker=function(){return this._video_input=this.el.find(".video_input").on("change",function(_this){return function(e){return _this.update_video(_this._video_input.val())}}(this))};ThemeEditor.prototype.apply_color=function(name,value){var hsl,is_black,rgb,shadow_color;switch(name){case"bg_color":return(this._wrapper||(this._wrapper=$("#wrapper"))).css("background-color",value);case"bg2_color":this._column.css("background-color",value);return(this._hrs||(this._hrs=this._column.find("hr"))).css("background-color",I.Color.sub_color(value));case"text_color":return this._column.css("color",value);case"link_color":(this._all_links||(this._all_links=this._column.find("a"))).css("color",value);(this._all_buttons||(this._all_buttons=this._column.find(".button"))).css("background-color",value);rgb=this.farb.unpack(value);hsl=this.farb.RGBToHSL(rgb);is_black=hsl[2]>=.75;shadow_color=I.Color.sub_color2(value);if(is_black){shadow_color="transparent"}this._all_buttons.css("color",is_black?"black":"white");return this._all_buttons.css("text-shadow","0 1px 0 "+shadow_color)}};ThemeEditor.prototype.setup_color_picker=function(){var all_inputs,first_picker;this.farb=$.farbtastic(this.el.find(".color_picker"),function(_this){return function(color){if(!_this.active_color){return}_this.active_color.find(".color_bubble").css("background-color",color).find("input.color_value").val(color);return _this.apply_color(_this.active_color.data("name"),color)}}(this));this.color_inputs=this.el.find(".color_inputs");all_inputs=this.color_inputs.find(".color_input");this.color_inputs.on("change","input.active_radio",function(_this){return function(e){all_inputs.removeClass("active");return _this.set_active_picker($(e.currentTarget).closest(".color_input"))}}(this));this.color_inputs.on("focus","input",function(_this){return function(e){all_inputs.removeClass("active");return _this.set_active_picker($(e.currentTarget).closest(".color_input"))}}(this));this.color_inputs.on("keyup","input.color_value",this.farb.updateValue).on("change","input.color_value",function(_this){return function(e){return $(e.currentTarget).val(_this.farb.color)}}(this));first_picker=all_inputs.first().find("input.active_radio").prop("checked",true).end();return this.set_active_picker(first_picker)};ThemeEditor.prototype.set_active_picker=function(picker){this.active_color=picker.addClass("active");picker.find(".active_radio").prop("checked",true);return this.farb.setColor(this.active_color.find("input.color_value").val())};return ThemeEditor}();ImageUpload=function(superClass){extend(ImageUpload,superClass);function ImageUpload(){return ImageUpload.__super__.constructor.apply(this,arguments)}ImageUpload.prototype.success_params={type:"layout",thumb_size:"original"};return ImageUpload}(I.ImageUpload);ImagePicker=function(){function ImagePicker(el,editor,update){this.editor=editor;if(update==null){update=null}if(update){this.update=update}this.el=$(el);this.el.dispatch("click",{remove_btn:function(_this){return function(){_this.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url","");_this.update(_this);return _this.make_upload_button()}}(this)});if(!this.el.is(".has_image")){this.make_upload_button()}this.el.on("change",function(_this){return function(){return _this.update(_this)}}(this))}ImagePicker.prototype.make_upload_button=function(){var btn;if(this.uploader){return}this.progress_inner||(this.progress_inner=this.el.find(".progress_inner"));btn=this.el.find(".upload_btn");return this.uploader=I.make_popup_upload_button(this.editor,btn,ImageUpload,{start_uploading:function(_this){return function(){_this.progress_inner.css({width:""});return _this.el.addClass("uploading")}}(this),finish_upload:function(_this){return function(upload,file){_this.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+file.url+")").end().find(".image_id_input").val(file.id).end().data("image_url",file.url);return _this.update(_this)}}(this)})};ImagePicker.prototype.update=function(self){};ImagePicker.prototype.get_position=function(){return(this._position_picker||(this._position_picker=this.el.find(".position_picker"))).val()};ImagePicker.prototype.to_css=function(){var position,repeat,url;url=this.el.data("image_url");repeat=(this._repeat_picker||(this._repeat_picker=this.el.find(".repeat_picker"))).val();position=function(){switch(this.get_position()){case"align_left":return"0 0";case"align_right":return"100% 0";case"align_center":return"50% 0"}}.call(this);return{"background-image":url?"url("+url+")":"none","background-position":position||"","background-repeat":repeat||""}};return ImagePicker}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.ViewGame=function(){function ViewGame(el,game1,opts1){var admin;this.game=game1;this.opts=opts1;this.setup_hiding=bind(this.setup_hiding,this);this.register_play=bind(this.register_play,this);this.setup_experiment=bind(this.setup_experiment,this);I.event2("view game",{type:this.game.type_name,paid:this.game.actual_price>0});I.tracked_links($(".jam_banner"),"view_game","jam_banner");this.el=$(el);this.setup_uploads();this.setup_experiment();I.tracked_links(this.el,"view_game","main_column");if(this.game.hit_url){$.get(this.game.hit_url)}if(this.game.play_url){this.register_play()}admin=$("#game_owner_panel");if(admin.exists()){this.admin=new I.AdminPanel(admin,this)}this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(I.is_mobile()||!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this),toggle_info_btn:function(_this){return function(el){el.closest(".more_information_toggle").toggleClass("open");return _this.el.find(".info_panel_wrapper").slideToggle()}}(this),download_btn:function(_this){return function(btn){var opts;I.event("view_game","download",""+_this.game.id);opts={};if(!btn.closest(".for_demo").length){opts.after_download_lightbox=true}I.ConversionTracker.download("1:"+_this.game.id);I.ConversionTracker.flush_now();return _this.prepare_download(btn.data("upload_id"),function(url,res){if(res.lightbox){_.defer(function(){var on_https,open_in_window;on_https=window.location.protocol.match("/^https\b");open_in_window=on_https&&!url.match(/^https\b/);if(res.external){window.open(url);return}if(open_in_window){return window.location=url}else{return $('<iframe frameborder="0" style="width: 0; height: 0; visibility: hidden;"></iframe>').attr("src",url).appendTo(document.body)}});return I.Lightbox.open(res.lightbox,I.AfterDownloadLightbox,_this.game)}else{return window.location=url}},opts)}}(this),fullscreen_btn:function(_this){return function(btn){var frame;frame=$(".game_frame");return I.toggle_fullscreen(frame[0])}}(this),buy_btn:function(_this){return function(btn){I.event("view_game","buy",""+_this.game.id);if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.BuyGameLightbox,_this.game,{is_donate:false})}}(this),reward_btn:function(_this){return function(btn){I.event("view_game","buy_reward",""+_this.game.id);return I.Lightbox.open_remote(btn.attr("href"),I.BuyGameLightbox,_this.game,{is_donate:false})}}(this),donate_btn:function(_this){return function(btn){I.event("view_game","donate",""+_this.game.id);if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.BuyGameLightbox,_this.game,{is_donate:btn.data("donate")})}}(this)});this.image_viewer=new I.ImageViewer(el);this.setup_referrer();if(this.opts.first_view){I.Lightbox.open_tpl("first_game_lightbox",I.FirstGameLightbox)}}ViewGame.prototype.setup_experiment=function(){if(I.experiment_buy_button_on_top){return this.el.addClass("buy_on_top_experiment")}};ViewGame.prototype.register_play=function(){return window.setTimeout(function(_this){return function(){return $.get(_this.game.play_url)}}(this),(this.game.play_after+3)*1e3)};ViewGame.prototype.prepare_download=function(upload_id,fn,params){if(params==null){params={}}return I.prepare_download(this.game.slug,upload_id,null,fn,params)};ViewGame.prototype.setup_uploads=function(){var el,i,len,ref1,results,size;this.uploads=this.el.find(".uploads");ref1=this.uploads.find(".upload");results=[];for(i=0,len=ref1.length;i<len;i++){el=ref1[i];size=$(el).find(".file_size_value");results.push(size.html(_.str.formatBytes(parseInt(size.html()))))}return results};ViewGame.prototype.setup_hiding=function(el){$(document.body).on("i:lightbox_open",function(_this){return function(){return $(el).css({visibility:"hidden"})}}(this));return $(document.body).on("i:lightbox_close",function(_this){return function(){return $(el).css({visibility:"visible"})}}(this))};ViewGame.prototype.fit_to_width=function(width){if(width>920){return $("#inner_column").width(width+40)}};ViewGame.prototype.setup_referrer=function(){var existing,host,ref;existing=$.cookie("ref:game:"+this.game.id);if(existing){return}host=$(document.body).data("host");ref=document.referrer;if(!ref){return}if(ref.indexOf(host)>=0){return}return I.set_cookie("ref:game:"+this.game.id,"game:"+ref,{expires:1})};return ViewGame}();I.ViewFlashGame=function(superClass){extend(ViewFlashGame,superClass);function ViewFlashGame(el,game,swf,opts){this.swf=swf;ViewFlashGame.__super__.constructor.call(this,el,game,opts);this.embed_game();this.setup_hiding("#swf_drop")}ViewFlashGame.prototype.get_size=function(fn){return $.get("/"+this.game.slug+"/swf_size/"+this.swf.id,function(_this){return function(res){_this.swf.data.swf=res.swf;return typeof fn==="function"?fn():void 0}}(this))};ViewFlashGame.prototype.embed_game=function(skip_remote){var height,ref1,width;if(!this.swf){return}if(!this.swf.data.swf&&!skip_remote){return this.get_size(function(_this){return function(){return _this.embed_game(true)}}(this))}ref1=this.swf.data.swf,width=ref1.width,height=ref1.height;this.fit_to_width(width);swfobject.embedSWF(this.swf.url,"swf_drop",width,height,"11.0.0",false,{},{wmode:"direct",allowfullscreen:"true"});this.swf_drop=$("#swf_drop");this.swf_drop.parent().width(width);return this.el.addClass("ready")};return ViewFlashGame}(I.ViewGame);I.ViewUnityGame=function(superClass){extend(ViewUnityGame,superClass);function ViewUnityGame(el,game,unity1,opts){this.unity=unity1;ViewUnityGame.__super__.constructor.call(this,el,game,opts);this.embed_game();this.setup_hiding("#unity_drop embed")}ViewUnityGame.prototype.embed_game=function(){var drop,track_unity,unity,width;if(!this.unity){return}drop=$("#unity_drop");width=drop.width();if(width>920){$("#inner_column").width(width+40)}unity=new UnityObject2({params:{disableContextMenu:true}});track_unity=_.once(function(status){return I.event("view_game","unity",""+status)});unity.observeProgress(function(_this){return function(progress){track_unity(progress.pluginStatus);if(progress.pluginStatus==="unsupported"){drop.width("").height("");$("#inner_column").width("");return _this.el.addClass("unity_unsupported")}else{return $(document.body).removeClass("responsive")}}}(this));return unity.initPlugin(drop[0],this.unity.url)};return ViewUnityGame}(I.ViewGame);I.ViewJavaGame=function(superClass){extend(ViewJavaGame,superClass);function ViewJavaGame(el,game,jar,opts){this.jar=jar;this.setup_hiding("#jar_drop applet");ViewJavaGame.__super__.constructor.call(this,el,game,opts)}return ViewJavaGame}(I.ViewGame);I.ViewHtmlGame=function(superClass){extend(ViewHtmlGame,superClass);ViewHtmlGame.prototype.ping_time=1e3;function ViewHtmlGame(el,game,archive,opts){var ref1;this.archive=archive;ViewHtmlGame.__super__.constructor.call(this,el,game,opts);if((ref1=this.archive)!=null?ref1.load_url:void 0){this.load_archive()}this.fit_to_width(this.el.find(".game_frame").width());if(opts.responsive){this.setup_responsive()}}ViewHtmlGame.prototype.setup_responsive=function(){var frame,reshape_game,win;frame=this.el.find(".game_frame");if(!frame.length){return}win=$(window);reshape_game=function(_this){return function(){var ratio,screen_w,w;w=frame.data("width");screen_w=win.width();if(screen_w<w){ratio=screen_w/win.height();return frame.css({height:Math.floor(frame.width()/ratio)+"px",maxHeight:"none"})}else{return frame.css({maxHeight:"",height:frame.data("height")+"px"})}}}(this);reshape_game();return win.on("resize",_.debounce(reshape_game,100))};ViewHtmlGame.prototype.show_error=function(msg){return this.el.addClass("has_error").find(".game_error .error_message").text(msg.join(", "))};ViewHtmlGame.prototype.load_archive=function(){return $.get(this.archive.load_url,function(_this){return function(res){if(res.url){_this.el.addClass("ready");_this.iframe=_this.el.find("#game_drop");_this.iframe.attr("src",res.url);return}if(res.status==="extracting"){setTimeout(function(){_this.ping_time+=100;return _this.load_archive()},_this.ping_time)}if(res.errors){return _this.show_error(res.errors)}}}(this))};return ViewHtmlGame}(I.ViewGame)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(superClass){extend(CommunityArchiveTopicLightbox,superClass);function CommunityArchiveTopicLightbox(){this.init=bind(this.init,this);return CommunityArchiveTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityArchiveTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityArchiveTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityBanLightbox=function(superClass){extend(CommunityBanLightbox,superClass);function CommunityBanLightbox(){this.init=bind(this.init,this);return CommunityBanLightbox.__super__.constructor.apply(this,arguments)}CommunityBanLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return _this.el.addClass("after_ban")}}(this))};return CommunityBanLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityBlocks=function(){function CommunityBlocks(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){I.flash(res.erorrs.join(", "),"error")}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}return CommunityBlocks}()}).call(this);(function(){I.CommunityCategory=function(){function CommunityCategory(el){this.el=$(el);this.el.dispatch("click",{rules_link:function(_this){return function(){return _this.el.addClass("rules_visible")}}(this)})}return CommunityCategory}()}).call(this);(function(){I.CommunityCategoryBans=function(){function CommunityCategoryBans(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){alert(res.errors.join("\n"));return}return window.location.reload()}}(this))}return CommunityCategoryBans}()}).call(this);(function(){I.CommunityCategoryModerators=function(){function CommunityCategoryModerators(el){this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(res.return_to){return window.location=res.return_to}}}(this))}return CommunityCategoryModerators}()}).call(this);(function(){I.CommunityProfile=function(){function CommunityProfile(el,opts){var c;this.el=$(el);I.has_follow_button(this.el);this.carousels=function(){var i,len,ref,results;ref=this.el.find(".game_carousel_widget");results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];results.push(new I.GameCarousel($(c)))}return results}.call(this);new I.CommunityViewTopic(this.el.find(".recent_posts"),opts)}return CommunityProfile}()}).call(this);(function(){I.CommunityEditCategory=function(){function CommunityEditCategory(el){var form;this.el=$(el);I.redactor(this.el.find("textarea"),{minHeight:100});this.setup_tag_editor();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityEditCategory.prototype.setup_tag_editor=function(){var tag_editor,tags;tag_editor=this.el.find(".category_tag_editor");if(!tag_editor.length){
return}tags=tag_editor.data("tags");return ReactDOM.render(R.Community.CategoryEditTags({tags:tags}),tag_editor[0])};return CommunityEditCategory}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(superClass){extend(CommunityLockTopicLightbox,superClass);function CommunityLockTopicLightbox(){this.init=bind(this.init,this);return CommunityLockTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityLockTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityLockTopicLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityNewTopic=function(){function CommunityNewTopic(el){var form;this.el=$(el);I.redactor(this.el.find("textarea"),{minHeight:100});form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}return CommunityNewTopic}()}).call(this);(function(){I.CommunityPostForm=function(){function CommunityPostForm(el,opts){var form;if(opts==null){opts={}}this.el=$(el);I.redactor(this.el.find("textarea"),$.extend({minHeight:100,focus:!!opts.focus},opts.redactor_opts));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){window.location=res.redirect_to}if(res.flash){return I.flash(res.flash)}}}(this))}return CommunityPostForm}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityReportPostLightbox=function(superClass){extend(CommunityReportPostLightbox,superClass);function CommunityReportPostLightbox(){this.init=bind(this.init,this);return CommunityReportPostLightbox.__super__.constructor.apply(this,arguments)}CommunityReportPostLightbox.prototype.init=function(){var form;return form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return _this.el.addClass("submitted_report")}}(this))};return CommunityReportPostLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(superClass){extend(CommunityStickTopicLightbox,superClass);function CommunityStickTopicLightbox(){this.init=bind(this.init,this);return CommunityStickTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityStickTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityStickTopicLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityTopicList=function(){function CommunityTopicList(el,opts){this.opts=opts;this.el=$(el);new I.CommunityTopicModerationTools(el,this.opts)}return CommunityTopicList}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicModerationTools=function(){CommunityTopicModerationTools.prototype.topic_url=function(route,topic_id){return this.opts.urls[route].replace(/:topic_id\b/,topic_id)};function CommunityTopicModerationTools(el,opts){this.opts=opts;this.topic_url=bind(this.topic_url,this);this.el=$(el);new I.FilterPickers(el);this.el.on("click",".filter_option",function(_this){return function(e){var target,topic_id,value;if($(e.target).is("a")){return}e.preventDefault();target=$(e.currentTarget).trigger("i:close_filter_pickers");topic_id=target.closest("[data-topic_id]").data("topic_id");value=target.data("value");switch(value){case"archive":case"unarchive":return I.Lightbox.open_remote(_this.topic_url("archive_topic",topic_id),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":return I.Lightbox.open_remote(_this.topic_url("lock_topic",topic_id),I.CommunityLockTopicLightbox);case"stick":case"unstick":return I.Lightbox.open_remote(_this.topic_url("stick_topic",topic_id),I.CommunityStickTopicLightbox);case"delete":if(confirm("Are you sure you want to delete this topic?")){return $.ajax({url:_this.topic_url("delete_topic",topic_id),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:true}}).done(function(res){if(res.errors){return alert(res.errors.join())}return window.location.reload()})}}}}(this))}return CommunityTopicModerationTools}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityViewTopic=function(){CommunityViewTopic.prototype.vote_counts_template=I.lazy_template(CommunityViewTopic,"vote_counts");function CommunityViewTopic(el,opts){this.opts=opts;this.update_votes=bind(this.update_votes,this);this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(el.is(".vote_btn")){if(res.errors){alert(res.errors.join(", "));return}_this.update_votes(el,res);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this));this.el.dispatch("click",{ban_user_btn:function(_this){return function(btn){var ban_url,post;post=btn.closest(".community_post").data("post");ban_url=_this.opts.ban_url+("?banned_user_id="+post.user_id);return I.Lightbox.open_remote(ban_url,I.CommunityBanLightbox)}}(this),stick_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityStickTopicLightbox)}}(this),lock_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityLockTopicLightbox)}}(this),report_post_btn:function(_this){return function(btn){var post,url;post=btn.closest(".community_post").data("post");url=_this.opts.report_url.replace(/:post_id/,post.id);return I.Lightbox.open_remote(url,I.CommunityReportPostLightbox)}}(this)})}CommunityViewTopic.prototype.update_votes=function(el,res){var i,len,post,v,voters;post=el.closest(".community_post");voters=post.find(".vote_btn");if(el.is(".voted")){el.removeClass("voted")}else{voters.removeClass("voted").filter(el).addClass("voted")}for(i=0,len=voters.length;i<len;i++){v=voters[i];v=$(v);if(v.is(".voted")){v.data("params").action="remove"}else{delete v.data("params").action}}return post.find(".vote_counts").html(this.vote_counts_template(res))};return CommunityViewTopic}()}).call(this);